<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Integrity Gatekeeper</title>

  <!-- Open Graph Meta Tags for link sharing -->
  <meta property="og:title" content=" " />
  <meta property="og:description" content=" " />
  <meta property="og:image" content="spiral-eye-logo.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="1200" />
  <meta property="og:type" content="website" />

  <!-- Apple-specific link preview -->
  <meta name="apple-mobile-web-app-title" content=" " />
  <link rel="apple-touch-icon" href="spiral-eye-logo.png" />

  <!-- Twitter Card data -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="spiral-eye-logo.png" />
  <meta name="twitter:title" content=" " />
  <meta name="twitter:description" content=" " />

  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Paste all your existing CSS styles here â€” for brevity, it's omitted in this example */
  </style>
</head>
<body>
  <!-- Paste your full body content here (Disclaimer page, Gatekeeper page, all phases, etc.) -->

  <!-- Example for where your content goes -->
  <div id="disclaimer-page">...</div>
  <div id="gatekeeper-page">...</div>
  <div id="phase1-page">...</div>
  <div id="phase2-page">...</div>
  <div id="phase3-page">...</div>

  <script>
    // Your full JavaScript logic including:
    // - DOMContentLoaded
    // - showPage
    // - validateAndProceed
    // - autosave/load/clearFormData/setupAutosave
    // - debounce

    // Keep all your previously provided JavaScript logic up to the middle of `generateDownloadableReflection`

    function generateDownloadableReflection() {
      const svgLogo = `<svg width="120" height="120" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
          <circle cx="60" cy="60" r="55" fill="none" stroke="#000" stroke-width="6"/>
          <path d="M30,60 C40,40 80,40 90,60 C80,80 40,80 30,60 Z" fill="none" stroke="#000" stroke-width="6"/>
          <path d="M60,60 C65,60 70,55 70,50 C70,45 65,40 60,40 C55,40 50,45 50,50 C50,55 55,60 60,60 C70,60 75,50 75,45 C75,35 65,30 60,30 C50,30 45,40 45,50 C45,60 50,70 60,70 C75,70 85,55 85,45 C85,30 70,25 60,25 C45,25 35,40 35,50 C35,65 50,75 60,75" fill="none" stroke="#000" stroke-width="6"/>
      </svg>`;
      const encodedLogo = btoa(svgLogo);

      const answers = [];
      for (let i = 1; i <= 30; i++) {
        const pageIndex = i <= 10 ? 1 : i <= 20 ? 2 : 3;
        const pageId = `#phase${pageIndex}-page`;
        const localIndex = i - (pageIndex - 1) * 10 + 1;
        const question = document.querySelector(`${pageId} .question:nth-child(${localIndex + 1}) p`).textContent;
        const answer = document.getElementById(`q${i}`).value.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        answers.push({ question, answer });
      }

      let htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Integrity Gatekeeper Reflection</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      margin: 0;
      padding: 0;
      background-color: #f9f5e7;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background-color: rgba(255, 255, 255, 0.85);
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #ddd;
    }
    .logo {
      width: 120px;
      height: 120px;
      margin: 0 auto 1rem auto;
    }
    .logo img {
      width: 100%;
      height: auto;
    }
    h1 {
      font-size: 2.4rem;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .date {
      font-style: italic;
      margin-bottom: 1.5rem;
    }
    .phase {
      margin-top: 2rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    .phase h2 {
      font-size: 1.5rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.5rem;
    }
    .question-container {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }
    .question {
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .answer {
      line-height: 1.6;
      white-space: pre-wrap;
    }
    .footer {
      text-align: center;
      margin-top: 3rem;
      font-style: italic;
      border-top: 1px solid #ddd;
      padding-top: 1rem;
    }
    @media print {
      body {
        background-color: white;
      }
      .container {
        border: none;
        padding: 0;
        max-width: 100%;
      }
      .question-container {
        page-break-inside: avoid;
      }
      .phase {
        page-break-before: always;
      }
      .phase:first-of-type {
        page-break-before: avoid;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <img src="data:image/svg+xml;base64,${encodedLogo}" alt="Logo" />
      </div>
      <h1>Integrity Gatekeeper</h1>
      <div class="date">${new Date().toLocaleDateString()}</div>
    </div>
    ${answers.map((entry, index) => `
      <div class="question-container">
        <div class="question">Q${index + 1}: ${entry.question}</div>
        <div class="answer">${entry.answer}</div>
      </div>`).join('')}
    <div class="footer">
      This reflection was generated for your eyes only. Honor what emerged.
    </div>
  </div>
</body>
</html>
`;

      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'integrity_reflection.html';
      a.click();
      URL.revokeObjectURL(url);
    }

    function submitReflection() {
      saveFormData();
      generateDownloadableReflection();
    }
  </script>
</body>
</html>